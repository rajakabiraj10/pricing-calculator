<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAPT Pricing Calculator - PIL Domestic 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .top-actions {
            padding: 20px 40px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: #667eea;
            color: white;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .content {
            padding: 40px;
        }

        .service-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .service-card {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .service-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .service-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .service-card h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .service-card p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.05em;
        }

        select, input[type="number"], input[type="text"], input[type="date"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        select:focus, input[type="number"]:focus, input[type="text"]:focus, input[type="date"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item.checked {
            background: #e7eaff;
            border-color: #667eea;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-weight: 600;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .results {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .results h2 {
            font-size: 2em;
            margin-bottom: 25px;
            text-align: center;
        }

        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .pricing-card {
            background: white;
            color: #333;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .pricing-card h3 {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .pricing-card .price {
            font-size: 2.5em;
            font-weight: bold;
            color: #764ba2;
            margin: 15px 0;
        }

        .pricing-card .label {
            font-size: 0.9em;
            opacity: 0.7;
            text-transform: uppercase;
        }

        .pricing-card.previous {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .pricing-card.previous h3 {
            color: #856404;
        }

        .pricing-card.previous .price {
            color: #856404;
        }

        .details {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .details h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .reset-btn, .save-quote-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            margin-right: 10px;
        }

        .reset-btn:hover, .save-quote-btn:hover {
            background: white;
            color: #667eea;
        }

        .note {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .note strong {
            display: block;
            margin-bottom: 5px;
        }

        .comparison-section {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .comparison-section h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price-change {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .price-change.increase {
            background: #ff6b6b;
            color: white;
        }

        .price-change.decrease {
            background: #51cf66;
            color: white;
        }

        .price-change.same {
            background: #868e96;
            color: white;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 1.8em;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #868e96;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #667eea;
        }

        .quotes-list {
            display: grid;
            gap: 15px;
        }

        .quote-item {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quote-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(5px);
        }

        .quote-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .quote-item-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .quote-item-date {
            font-size: 0.9em;
            color: #868e96;
        }

        .quote-item-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .quote-item-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
        }

        .quote-detail {
            font-size: 0.9em;
        }

        .quote-detail strong {
            color: #667eea;
        }

        .search-filter {
            margin-bottom: 20px;
        }

        .search-filter input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
        }

        .filter-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 15px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #868e96;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .service-selector {
                grid-template-columns: 1fr;
            }

            .pricing-cards {
                grid-template-columns: 1fr;
            }

            .top-actions {
                padding: 15px 20px;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí VAPT Pricing Calculator</h1>
            <p>PIL Domestic Rate Chart 2025 - Instant Quote Generator</p>
        </div>

        <div class="top-actions">
            <button class="action-btn primary" onclick="showSection('calculator')">
                <span>‚ûï</span> New Quote
            </button>
            <button class="action-btn" onclick="openQuoteHistory()">
                <span>üìã</span> Previous Quotes
            </button>
            <button class="action-btn" onclick="exportQuotes()">
                <span>üíæ</span> Export Data
            </button>
            <button class="action-btn" onclick="importQuotes()">
                <span>üì§</span> Import Data
            </button>
        </div>

        <div class="content">
            <div class="service-selector">
                <div class="service-card" onclick="selectService('app')">
                    <h3>üì± Application Audit</h3>
                    <p>Web & Mobile App Security Testing</p>
                </div>
                <div class="service-card" onclick="selectService('infra')">
                    <h3>üåê Infrastructure VAPT</h3>
                    <p>Network & System Penetration Testing</p>
                </div>
                <div class="service-card" onclick="selectService('iso')">
                    <h3>üìã ISO Process</h3>
                    <p>Certification & Consulting Services</p>
                </div>
            </div>

            <!-- Application Audit Form -->
            <div id="app-form" class="form-section">
                <h2 style="margin-bottom: 25px; color: #667eea;">Application Audit Configuration</h2>
                
                <div class="form-group">
                    <label>Client Name</label>
                    <input type="text" id="app-client-name" placeholder="Enter client name">
                </div>

                <div class="form-group">
                    <label>Project Name/Description</label>
                    <input type="text" id="app-project-name" placeholder="Enter project name or description">
                </div>
                
                <div class="form-group">
                    <label>Service Type</label>
                    <select id="app-service">
                        <option value="">-- Select Service --</option>
                        <option value="essential">Essentials Package (Small Business - Up to 4 dynamic pages)</option>
                        <option value="professional">Professional Package (Midsize Business - Up to 6 dynamic pages)</option>
                        <option value="enterprise">Enterprise Package (Critical Application - Up to 8 dynamic pages)</option>
                        <option value="ultimate">Ultimate Package (Large Critical Application - Custom)</option>
                        <option value="sast-50k">Source Code Review (SAST) - Up to 50,000 lines</option>
                        <option value="sast-250k">Source Code Review (SAST) - 50,000 to 250,000 lines</option>
                        <option value="sast-1m">Source Code Review (SAST) - 250,000 to 1,000,000 lines</option>
                        <option value="sast-over">Source Code Review (SAST) - Over 1,000,000 lines</option>
                        <option value="api">API Audit</option>
                    </select>
                </div>

                <div class="form-group" id="app-quantity-group" style="display: none;">
                    <label>Number of Applications</label>
                    <input type="number" id="app-quantity" min="1" value="1">
                </div>

                <div class="form-group" id="lines-of-code-group" style="display: none;">
                    <label>Number of Lines of Code</label>
                    <input type="number" id="lines-of-code" min="1" value="50000">
                </div>

                <div class="form-group">
                    <label>Application Type</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item" onclick="toggleCheckbox(this)">
                            <input type="checkbox" id="app-web" value="web">
                            <label for="app-web" style="margin: 0; cursor: pointer;">Web Application</label>
                        </div>
                        <div class="checkbox-item" onclick="toggleCheckbox(this)">
                            <input type="checkbox" id="app-android" value="android">
                            <label for="app-android" style="margin: 0; cursor: pointer;">Android Application</label>
                        </div>
                        <div class="checkbox-item" onclick="toggleCheckbox(this)">
                            <input type="checkbox" id="app-ios" value="ios">
                            <label for="app-ios" style="margin: 0; cursor: pointer;">iOS Application</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="app-notes" placeholder="Any additional requirements or notes..."></textarea>
                </div>

                <button class="calculate-btn" onclick="calculatePrice()">Calculate Price</button>
            </div>

            <!-- Infrastructure VAPT Form -->
            <div id="infra-form" class="form-section">
                <h2 style="margin-bottom: 25px; color: #667eea;">Infrastructure VAPT Configuration</h2>
                
                <div class="form-group">
                    <label>Client Name</label>
                    <input type="text" id="infra-client-name" placeholder="Enter client name">
                </div>

                <div class="form-group">
                    <label>Project Name/Description</label>
                    <input type="text" id="infra-project-name" placeholder="Enter project name or description">
                </div>
                
                <div class="form-group">
                    <label>Service Type</label>
                    <select id="infra-service">
                        <option value="">-- Select Service --</option>
                        <option value="essential">VAPT Essentials - Up to 25 IPs (3-5 days)</option>
                        <option value="professional">VAPT Professional - Up to 50 IPs (5-8 days)</option>
                        <option value="enterprise">VAPT Enterprise - Up to 100 IPs (8-12 days)</option>
                        <option value="ultimate">VAPT Ultimate - Up to 200 IPs (12-15 days)</option>
                        <option value="network-arch">Network Architecture Review</option>
                        <option value="network-config">Network Configuration Analysis</option>
                        <option value="custom">Custom - Select Individual Elements</option>
                    </select>
                </div>

                <div id="custom-elements" style="display: none; margin-top: 25px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Select Network Elements</h3>
                    <div class="form-group">
                        <label>Server</label>
                        <input type="number" id="server-count" min="0" value="0" placeholder="Number of servers">
                    </div>
                    <div class="form-group">
                        <label>Storage</label>
                        <input type="number" id="storage-count" min="0" value="0" placeholder="Number of storage devices">
                    </div>
                    <div class="form-group">
                        <label>Router</label>
                        <input type="number" id="router-count" min="0" value="0" placeholder="Number of routers">
                    </div>
                    <div class="form-group">
                        <label>Managed Switch</label>
                        <input type="number" id="managed-switch-count" min="0" value="0" placeholder="Number of managed switches">
                    </div>
                    <div class="form-group">
                        <label>Firewall</label>
                        <input type="number" id="firewall-count" min="0" value="0" placeholder="Number of firewalls">
                    </div>
                    <div class="form-group">
                        <label>WiFi Controller</label>
                        <input type="number" id="wifi-count" min="0" value="0" placeholder="Number of WiFi controllers">
                    </div>
                    <div class="form-group">
                        <label>Unmanaged Switch</label>
                        <input type="number" id="unmanaged-switch-count" min="0" value="0" placeholder="Number of unmanaged switches">
                    </div>
                    <div class="form-group">
                        <label>Desktop</label>
                        <input type="number" id="desktop-count" min="0" value="0" placeholder="Number of desktops">
                    </div>
                </div>

                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="infra-notes" placeholder="Any additional requirements or notes..."></textarea>
                </div>

                <button class="calculate-btn" onclick="calculatePrice()">Calculate Price</button>
            </div>

            <!-- ISO Process Form -->
            <div id="iso-form" class="form-section">
                <h2 style="margin-bottom: 25px; color: #667eea;">ISO Process Configuration</h2>
                
                <div class="form-group">
                    <label>Client Name</label>
                    <input type="text" id="iso-client-name" placeholder="Enter client name">
                </div>

                <div class="form-group">
                    <label>Project Name/Description</label>
                    <input type="text" id="iso-project-name" placeholder="Enter project name or description">
                </div>
                
                <div class="form-group">
                    <label>Service Type</label>
                    <select id="iso-service">
                        <option value="">-- Select Service --</option>
                        <option value="iso27001-consult">ISO 27001 (ISMS) - Consulting & Implementation</option>
                        <option value="iso22301-consult">ISO 22301 (BCMS) - Consulting & Implementation</option>
                        <option value="iso27701-consult">ISO 27701 (PIMS) - Consulting & Implementation</option>
                        <option value="iso20000-consult">ISO 20000 (ITSM) - Consulting & Implementation</option>
                        <option value="iso27001-cert">ISO 27001 Certification (Single Location, 50 employees)</option>
                        <option value="iso22301-cert">ISO 22301 Certification (Single Location, 50 employees)</option>
                        <option value="iso27701-cert">ISO 27701 Certification (Single Location, 50 employees)</option>
                        <option value="iso20001-cert">ISO 20001 Certification (Single Location, 50 employees)</option>
                        <option value="maturity">Cyber Security Maturity Assessment</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="iso-notes" placeholder="Any additional requirements or notes..."></textarea>
                </div>

                <button class="calculate-btn" onclick="calculatePrice()">Calculate Price</button>
            </div>

            <!-- Results Section -->
            <div id="results" class="results">
                <h2>üí∞ Your Quote</h2>
                <div class="pricing-cards" id="pricing-cards"></div>
                <div class="comparison-section" id="comparison-section" style="display: none;"></div>
                <div class="details" id="details"></div>
                <div style="margin-top: 20px;">
                    <button class="save-quote-btn" onclick="saveQuote()">üíæ Save Quote</button>
                    <button class="reset-btn" onclick="resetCalculator()">üîÑ New Quote</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quote History Modal -->
    <div id="quote-history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Previous Quotations</h2>
                <button class="close-modal" onclick="closeQuoteHistory()">&times;</button>
            </div>
            
            <div class="search-filter">
                <input type="text" id="search-quotes" placeholder="üîç Search by client name, project, or service..." onkeyup="filterQuotes()">
                <div class="filter-options">
                    <button class="filter-btn active" onclick="filterByService('all')">All Services</button>
                    <button class="filter-btn" onclick="filterByService('app')">Application Audit</button>
                    <button class="filter-btn" onclick="filterByService('infra')">Infrastructure VAPT</button>
                    <button class="filter-btn" onclick="filterByService('iso')">ISO Process</button>
                </div>
            </div>

            <div class="quotes-list" id="quotes-list">
                <!-- Quotes will be populated here -->
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="import-file-input" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <script>
        let currentService = null;
        let currentQuote = null;
        let allQuotes = [];
        let currentFilter = 'all';

        const rates = {
            app: {
                essential: { level1: 50000, level2: 35000, level3: 'TBD' },
                professional: { level1: 75000, level2: 60000, level3: 'TBD' },
                enterprise: { level1: 100000, level2: 75000, level3: 'TBD' },
                ultimate: { level1: 'TBD', level2: 'TBD', level3: 'TBD' },
                'sast-50k': { level1: 0.6, level2: 0.5, level3: 'TBD', perLine: true },
                'sast-250k': { level1: 0.5, level2: 0.4, level3: 'TBD', perLine: true },
                'sast-1m': { level1: 0.4, level2: 0.3, level3: 'TBD', perLine: true },
                'sast-over': { level1: 'TBD', level2: 'TBD', level3: 'TBD' },
                api: { level1: 10000, level2: 7500, level3: 'TBD' }
            },
            infra: {
                essential: { level1: 75000, level2: 50000, level3: 'TBD' },
                professional: { level1: 100000, level2: 90000, level3: 'TBD' },
                enterprise: { level1: 175000, level2: 150000, level3: 'TBD' },
                ultimate: { level1: 300000, level2: 250000, level3: 'TBD' },
                'network-arch': { level1: 125000, level2: 100000, level3: 'TBD' },
                'network-config': { level1: 125000, level2: 100000, level3: 'TBD' },
                elements: {
                    server: { level1: 5000, level2: 3500, level3: 'TBD' },
                    storage: { level1: 5000, level2: 4000, level3: 'TBD' },
                    router: { level1: 3000, level2: 2500, level3: 'TBD' },
                    'managed-switch': { level1: 2500, level2: 2000, level3: 'TBD' },
                    firewall: { level1: 5000, level2: 5000, level3: 'TBD' },
                    wifi: { level1: 5000, level2: 3500, level3: 'TBD' },
                    'unmanaged-switch': { level1: 1000, level2: 1000, level3: 'TBD' },
                    desktop: { level1: 1000, level2: 500, level3: 'TBD' }
                }
            },
            iso: {
                'iso27001-consult': 300000,
                'iso22301-consult': 300000,
                'iso27701-consult': 350000,
                'iso20000-consult': 300000,
                'iso27001-cert': 150000,
                'iso22301-cert': 150000,
                'iso27701-cert': 150000,
                'iso20001-cert': 150000,
                'maturity': 250000
            }
        };

        // Load saved quotes from localStorage
        function loadQuotes() {
            const saved = localStorage.getItem('vapt-quotes');
            if (saved) {
                allQuotes = JSON.parse(saved);
            }
        }

        // Save quotes to localStorage
        function saveQuotesToStorage() {
            localStorage.setItem('vapt-quotes', JSON.stringify(allQuotes));
        }

        function selectService(service) {
            currentService = service;
            document.querySelectorAll('.service-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.service-card').classList.add('active');
            
            document.querySelectorAll('.form-section').forEach(form => form.classList.remove('active'));
            document.getElementById(`${service}-form`).classList.add('active');
            document.getElementById('results').classList.remove('show');
        }

        function toggleCheckbox(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('checked', checkbox.checked);
        }

        document.getElementById('app-service').addEventListener('change', function() {
            const value = this.value;
            const quantityGroup = document.getElementById('app-quantity-group');
            const linesGroup = document.getElementById('lines-of-code-group');
            
            if (value.startsWith('sast-')) {
                if (value !== 'sast-over') {
                    linesGroup.style.display = 'block';
                } else {
                    linesGroup.style.display = 'none';
                }
                quantityGroup.style.display = 'none';
            } else if (value && value !== 'ultimate') {
                quantityGroup.style.display = 'block';
                linesGroup.style.display = 'none';
            } else {
                quantityGroup.style.display = 'none';
                linesGroup.style.display = 'none';
            }
        });

        document.getElementById('infra-service').addEventListener('change', function() {
            const customElements = document.getElementById('custom-elements');
            if (this.value === 'custom') {
                customElements.style.display = 'block';
            } else {
                customElements.style.display = 'none';
            }
        });

        function formatCurrency(amount) {
            if (amount === 'TBD') return 'TBD';
            return '‚Çπ' + amount.toLocaleString('en-IN');
        }

        function calculatePrice() {
            let result = {
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('en-IN'),
            };
            
            if (currentService === 'app') {
                const service = document.getElementById('app-service').value;
                const clientName = document.getElementById('app-client-name').value.trim();
                const projectName = document.getElementById('app-project-name').value.trim();
                const notes = document.getElementById('app-notes').value.trim();

                if (!service) {
                    alert('Please select a service type');
                    return;
                }

                if (!clientName) {
                    alert('Please enter client name');
                    return;
                }

                const webChecked = document.getElementById('app-web').checked;
                const androidChecked = document.getElementById('app-android').checked;
                const iosChecked = document.getElementById('app-ios').checked;
                const platformCount = [webChecked, androidChecked, iosChecked].filter(Boolean).length;

                if (platformCount === 0) {
                    alert('Please select at least one application type');
                    return;
                }

                const rate = rates.app[service];
                result.clientName = clientName;
                result.projectName = projectName || 'N/A';
                result.notes = notes;

                if (rate.perLine) {
                    const lines = parseInt(document.getElementById('lines-of-code').value) || 0;
                    if (lines === 0) {
                        alert('Please enter number of lines of code');
                        return;
                    }
                    result = {
                        ...result,
                        service: 'Application Audit',
                        serviceType: document.getElementById('app-service').selectedOptions[0].text,
                        serviceCode: service,
                        level1: rate.level1 === 'TBD' ? 'TBD' : Math.round(rate.level1 * lines * platformCount),
                        level2: rate.level2 === 'TBD' ? 'TBD' : Math.round(rate.level2 * lines * platformCount),
                        level3: 'TBD - Management Approval Required',
                        details: [
                            { label: 'Lines of Code', value: lines.toLocaleString() },
                            { label: 'Rate (Level 1)', value: rate.level1 === 'TBD' ? 'TBD' : `‚Çπ${rate.level1} per line` },
                            { label: 'Rate (Level 2)', value: rate.level2 === 'TBD' ? 'TBD' : `‚Çπ${rate.level2} per line` },
                            { label: 'Platforms', value: platformCount },
                            { label: 'Selected Platforms', value: [webChecked && 'Web', androidChecked && 'Android', iosChecked && 'iOS'].filter(Boolean).join(', ') }
                        ],
                        searchableText: `${clientName} ${projectName} ${service}`.toLowerCase()
                    };
                } else {
                    const quantity = service === 'ultimate' ? 1 : (parseInt(document.getElementById('app-quantity').value) || 1);
                    result = {
                        ...result,
                        service: 'Application Audit',
                        serviceType: document.getElementById('app-service').selectedOptions[0].text,
                        serviceCode: service,
                        level1: rate.level1 === 'TBD' ? 'TBD' : rate.level1 * quantity * platformCount,
                        level2: rate.level2 === 'TBD' ? 'TBD' : rate.level2 * quantity * platformCount,
                        level3: 'TBD - Management Approval Required',
                        details: [
                            { label: 'Number of Applications', value: quantity },
                            { label: 'Platforms', value: platformCount },
                            { label: 'Selected Platforms', value: [webChecked && 'Web', androidChecked && 'Android', iosChecked && 'iOS'].filter(Boolean).join(', ') },
                            { label: 'Base Rate (Level 1)', value: formatCurrency(rate.level1) },
                            { label: 'Base Rate (Level 2)', value: formatCurrency(rate.level2) }
                        ],
                        searchableText: `${clientName} ${projectName} ${service}`.toLowerCase()
                    };
                }

                if (service === 'ultimate' || service === 'sast-over') {
                    result.note = 'Custom pricing required. Please contact management for approval.';
                }

            } else if (currentService === 'infra') {
                const service = document.getElementById('infra-service').value;
                const clientName = document.getElementById('infra-client-name').value.trim();
                const projectName = document.getElementById('infra-project-name').value.trim();
                const notes = document.getElementById('infra-notes').value.trim();

                if (!service) {
                    alert('Please select a service type');
                    return;
                }

                if (!clientName) {
                    alert('Please enter client name');
                    return;
                }

                result.clientName = clientName;
                result.projectName = projectName || 'N/A';
                result.notes = notes;

                if (service === 'custom') {
                    let totalLevel1 = 0;
                    let totalLevel2 = 0;
                    const breakdown = [];

                    const elements = ['server', 'storage', 'router', 'managed-switch', 'firewall', 'wifi', 'unmanaged-switch', 'desktop'];
                    const labels = {
                        'server': 'Server',
                        'storage': 'Storage',
                        'router': 'Router',
                        'managed-switch': 'Managed Switch',
                        'firewall': 'Firewall',
                        'wifi': 'WiFi Controller',
                        'unmanaged-switch': 'Unmanaged Switch',
                        'desktop': 'Desktop'
                    };

                    elements.forEach(elem => {
                        const count = parseInt(document.getElementById(`${elem}-count`).value) || 0;
                        if (count > 0) {
                            const rate = rates.infra.elements[elem];
                            totalLevel1 += rate.level1 * count;
                            totalLevel2 += rate.level2 * count;
                            breakdown.push({
                                label: `${labels[elem]} (${count})`,
                                value: `L1: ${formatCurrency(rate.level1 * count)}, L2: ${formatCurrency(rate.level2 * count)}`
                            });
                        }
                    });

                    if (totalLevel1 === 0) {
                        alert('Please enter at least one network element');
                        return;
                    }

                    result = {
                        ...result,
                        service: 'Infrastructure VAPT',
                        serviceType: 'Custom Configuration',
                        serviceCode: service,
                        level1: totalLevel1,
                        level2: totalLevel2,
                        level3: 'TBD - Management Approval Required',
                        details: breakdown,
                        searchableText: `${clientName} ${projectName} infrastructure custom`.toLowerCase()
                    };
                } else {
                    const rate = rates.infra[service];
                    result = {
                        ...result,
                        service: 'Infrastructure VAPT',
                        serviceType: document.getElementById('infra-service').selectedOptions[0].text,
                        serviceCode: service,
                        level1: rate.level1,
                        level2: rate.level2,
                        level3: 'TBD - Management Approval Required',
                        details: [],
                        searchableText: `${clientName} ${projectName} ${service}`.toLowerCase()
                    };
                }

            } else if (currentService === 'iso') {
                const service = document.getElementById('iso-service').value;
                const clientName = document.getElementById('iso-client-name').value.trim();
                const projectName = document.getElementById('iso-project-name').value.trim();
                const notes = document.getElementById('iso-notes').value.trim();

                if (!service) {
                    alert('Please select a service type');
                    return;
                }

                if (!clientName) {
                    alert('Please enter client name');
                    return;
                }

                const price = rates.iso[service];
                result = {
                    ...result,
                    clientName: clientName,
                    projectName: projectName || 'N/A',
                    notes: notes,
                    service: 'ISO Process',
                    serviceType: document.getElementById('iso-service').selectedOptions[0].text,
                    serviceCode: service,
                    fixedPrice: price,
                    details: [],
                    searchableText: `${clientName} ${projectName} ${service}`.toLowerCase()
                };
            }

            currentQuote = result;
            displayResults(result);
        }

        function displayResults(result) {
            const pricingCards = document.getElementById('pricing-cards');
            const details = document.getElementById('details');
            const comparisonSection = document.getElementById('comparison-section');

            let cardsHTML = '';
            
            if (result.fixedPrice) {
                cardsHTML = `
                    <div class="pricing-card">
                        <div class="label">Standard Price</div>
                        <div class="price">${formatCurrency(result.fixedPrice)}</div>
                    </div>
                `;
            } else {
                cardsHTML = `
                    <div class="pricing-card">
                        <h3>Level 1 (Standard)</h3>
                        <div class="price">${formatCurrency(result.level1)}</div>
                        <div class="label">High Value Pricing</div>
                    </div>
                    <div class="pricing-card">
                        <h3>Level 2 (Discounted)</h3>
                        <div class="price">${formatCurrency(result.level2)}</div>
                        <div class="label">Low Value Pricing</div>
                    </div>
                    <div class="pricing-card">
                        <h3>Level 3 (Custom)</h3>
                        <div class="price">TBD</div>
                        <div class="label">Management Approval</div>
                    </div>
                `;
            }

            // Check for previous quotes from same client
            const previousQuotes = allQuotes.filter(q => 
                q.clientName.toLowerCase() === result.clientName.toLowerCase() &&
                q.service === result.service
            );

            if (previousQuotes.length > 0) {
                comparisonSection.style.display = 'block';
                const latestPrevious = previousQuotes[previousQuotes.length - 1];
                
                let comparisonHTML = `
                    <h3>üìä Comparison with Previous Quote</h3>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                `;

                if (result.fixedPrice && latestPrevious.fixedPrice) {
                    const diff = result.fixedPrice - latestPrevious.fixedPrice;
                    const diffClass = diff > 0 ? 'increase' : diff < 0 ? 'decrease' : 'same';
                    const diffSymbol = diff > 0 ? '‚Üë' : diff < 0 ? '‚Üì' : '=';
                    comparisonHTML += `
                        <div>
                            <div style="font-size: 0.9em; opacity: 0.8; margin-bottom: 5px;">Previous Price</div>
                            <div style="font-size: 1.5em; font-weight: bold;">${formatCurrency(latestPrevious.fixedPrice)}</div>
                            ${diff !== 0 ? `<div class="price-change ${diffClass}">${diffSymbol} ${formatCurrency(Math.abs(diff))}</div>` : '<div class="price-change same">No Change</div>'}
                        </div>
                    `;
                } else if (result.level1 && latestPrevious.level1) {
                    ['level1', 'level2'].forEach((level, idx) => {
                        const levelName = idx === 0 ? 'Level 1' : 'Level 2';
                        if (typeof result[level] === 'number' && typeof latestPrevious[level] === 'number') {
                            const diff = result[level] - latestPrevious[level];
                            const diffClass = diff > 0 ? 'increase' : diff < 0 ? 'decrease' : 'same';
                            const diffSymbol = diff > 0 ? '‚Üë' : diff < 0 ? '‚Üì' : '=';
                            comparisonHTML += `
                                <div>
                                    <div style="font-size: 0.9em; opacity: 0.8; margin-bottom: 5px;">Previous ${levelName}</div>
                                    <div style="font-size: 1.5em; font-weight: bold;">${formatCurrency(latestPrevious[level])}</div>
                                    ${diff !== 0 ? `<div class="price-change ${diffClass}">${diffSymbol} ${formatCurrency(Math.abs(diff))}</div>` : '<div class="price-change same">No Change</div>'}
                                </div>
                            `;
                        }
                    });
                }

                comparisonHTML += `
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <strong>Previous Quote Date:</strong> ${latestPrevious.date}<br>
                            <strong>Project:</strong> ${latestPrevious.projectName}
                        </div>
                    </div>
                `;
                comparisonSection.innerHTML = comparisonHTML;
            } else {
                comparisonSection.style.display = 'none';
            }

            pricingCards.innerHTML = cardsHTML;

            let detailsHTML = `
                <h3>Quote Details</h3>
                <div class="detail-item">
                    <span><strong>Client Name:</strong></span>
                    <span>${result.clientName}</span>
                </div>
                <div class="detail-item">
                    <span><strong>Project:</strong></span>
                    <span>${result.projectName}</span>
                </div>
                <div class="detail-item">
                    <span><strong>Date:</strong></span>
                    <span>${result.date}</span>
                </div>
                <div class="detail-item">
                    <span><strong>Service Category:</strong></span>
                    <span>${result.service}</span>
                </div>
                <div class="detail-item">
                    <span><strong>Service Type:</strong></span>
                    <span>${result.serviceType}</span>
                </div>
            `;

            if (result.details && result.details.length > 0) {
                result.details.forEach(detail => {
                    detailsHTML += `
                        <div class="detail-item">
                            <span><strong>${detail.label}:</strong></span>
                            <span>${detail.value}</span>
                        </div>
                    `;
                });
            }

            if (result.notes) {
                detailsHTML += `
                    <div class="detail-item">
                        <span><strong>Notes:</strong></span>
                        <span>${result.notes}</span>
                    </div>
                `;
            }

            detailsHTML += '</div>';

            if (result.note) {
                detailsHTML += `
                    <div class="note">
                        <strong>‚ö†Ô∏è Note:</strong>
                        ${result.note}
                    </div>
                `;
            }

            details.innerHTML = detailsHTML;
            document.getElementById('results').classList.add('show');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function saveQuote() {
            if (!currentQuote) return;

            currentQuote.id = Date.now();
            allQuotes.push(currentQuote);
            saveQuotesToStorage();
            
            alert('‚úÖ Quote saved successfully!');
        }

        function openQuoteHistory() {
            loadQuotes();
            displayQuotesList();
            document.getElementById('quote-history-modal').classList.add('show');
        }

        function closeQuoteHistory() {
            document.getElementById('quote-history-modal').classList.remove('show');
        }

        function displayQuotesList() {
            const quotesList = document.getElementById('quotes-list');
            
            if (allQuotes.length === 0) {
                quotesList.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 3em; margin-bottom: 10px;">üìã</div>
                        <h3>No Quotes Yet</h3>
                        <p>Start creating quotes to see them here</p>
                    </div>
                `;
                return;
            }

            let filteredQuotes = allQuotes;
            if (currentFilter !== 'all') {
                filteredQuotes = allQuotes.filter(q => q.service.toLowerCase().includes(currentFilter));
            }

            const searchTerm = document.getElementById('search-quotes').value.toLowerCase();
            if (searchTerm) {
                filteredQuotes = filteredQuotes.filter(q => 
                    q.searchableText.includes(searchTerm)
                );
            }

            if (filteredQuotes.length === 0) {
                quotesList.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 3em; margin-bottom: 10px;">üîç</div>
                        <h3>No Matching Quotes</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }

            filteredQuotes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            let html = '';
            filteredQuotes.forEach(quote => {
                const price = quote.fixedPrice ? formatCurrency(quote.fixedPrice) : 
                              `L1: ${formatCurrency(quote.level1)}, L2: ${formatCurrency(quote.level2)}`;
                
                html += `
                    <div class="quote-item" onclick="viewQuoteDetails(${quote.id})">
                        <div class="quote-item-header">
                            <div>
                                <div class="quote-item-title">${quote.clientName}</div>
                                <div class="quote-item-date">üìÖ ${quote.date}</div>
                            </div>
                            <div class="quote-item-price">${price}</div>
                        </div>
                        <div class="quote-item-details">
                            <div class="quote-detail">
                                <strong>Service:</strong> ${quote.service}
                            </div>
                            <div class="quote-detail">
                                <strong>Type:</strong> ${quote.serviceType}
                            </div>
                            <div class="quote-detail">
                                <strong>Project:</strong> ${quote.projectName}
                            </div>
                        </div>
                    </div>
                `;
            });

            quotesList.innerHTML = html;
        }

        function viewQuoteDetails(quoteId) {
            const quote = allQuotes.find(q => q.id === quoteId);
            if (!quote) return;

            closeQuoteHistory();
            currentQuote = quote;
            displayResults(quote);
        }

        function filterQuotes() {
            displayQuotesList();
        }

        function filterByService(service) {
            currentFilter = service;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayQuotesList();
        }

        function exportQuotes() {
            if (allQuotes.length === 0) {
                alert('No quotes to export');
                return;
            }

            const dataStr = JSON.stringify(allQuotes, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `vapt-quotes-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Quotes exported successfully!');
        }

        function importQuotes() {
            document.getElementById('import-file-input').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedQuotes = JSON.parse(e.target.result);
                    if (!Array.isArray(importedQuotes)) {
                        throw new Error('Invalid format');
                    }
                    
                    allQuotes = [...allQuotes, ...importedQuotes];
                    saveQuotesToStorage();
                    alert(`‚úÖ Successfully imported ${importedQuotes.length} quotes!`);
                } catch (error) {
                    alert('‚ùå Error importing file. Please ensure it\'s a valid JSON file.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetCalculator() {
            document.querySelectorAll('.service-card').forEach(card => card.classList.remove('active'));
            document.querySelectorAll('.form-section').forEach(form => form.classList.remove('active'));
            document.getElementById('results').classList.remove('show');
            
            document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            document.querySelectorAll('input[type="number"]').forEach(input => input.value = input.min || 0);
            document.querySelectorAll('input[type="text"]').forEach(input => input.value = '');
            document.querySelectorAll('textarea').forEach(textarea => textarea.value = '');
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.checkbox-item').classList.remove('checked');
            });
            
            currentService = null;
            currentQuote = null;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showSection(section) {
            if (section === 'calculator') {
                resetCalculator();
            }
        }

        // Initialize
        loadQuotes();
    </script>
</body>
</html>
